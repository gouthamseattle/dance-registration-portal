<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Dance Registration Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/admin-styles.css?v=9" rel="stylesheet">
    <meta name="robots" content="noindex, nofollow">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading dashboard...</p>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-lock"></i>
                        Admin Login
                    </h5>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <div id="loginError" class="alert alert-danger" style="display: none;"></div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt"></i>
                                Login
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-music"></i>
                Dance Registration Admin
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="courses">
                            <i class="fas fa-graduation-cap"></i>
                            Dance Series
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="registrations">
                            <i class="fas fa-users"></i>
                            Registrations
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="reports">
                            <i class="fas fa-chart-bar"></i>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="settings">
                            <i class="fas fa-cog"></i>
                            Settings
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i>
                            <span id="adminUsername">Admin</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/" target="_blank">
                                <i class="fas fa-external-link-alt"></i>
                                View Student Portal
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="content-section">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-tachometer-alt text-primary"></i> Dashboard</h2>
                        <div class="registration-toggle">
                            <label class="form-check-label me-2" for="registrationToggle">
                                <strong>Registration Status:</strong>
                            </label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="registrationToggle">
                                <label class="form-check-label" for="registrationToggle" id="registrationStatus">
                                    Closed
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card stat-card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Total Registrations</h6>
                                    <h3 class="mb-0" id="totalRegistrations">0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card stat-card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Revenue</h6>
                                    <h3 class="mb-0" id="totalRevenue">$0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-dollar-sign fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card stat-card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Active Courses</h6>
                                    <h3 class="mb-0" id="activeCourses">0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-graduation-cap fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card stat-card bg-warning text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Pending Payments</h6>
                                    <h3 class="mb-0" id="pendingPayments">0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-clock fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-bolt text-primary"></i> Quick Actions</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-success w-100" onclick="admin.showCreateCourse()">
                                        <i class="fas fa-graduation-cap"></i>
                                        New Dance Series
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-info w-100" onclick="admin.exportRegistrations()">
                                        <i class="fas fa-download"></i>
                                        Export Data
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-secondary w-100" onclick="admin.generateShareLink()">
                                        <i class="fas fa-share"></i>
                                        Share Link
                                    </button>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-6 mb-2">
                                    <button class="btn btn-danger w-100" onclick="admin.resetKeepCourse(false)">
                                        <i class="fas fa-trash-restore"></i>
                                        Reset Data (Keep Active Course)
                                    </button>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <button class="btn btn-outline-danger w-100" onclick="admin.resetKeepCourse(true)">
                                        <i class="fas fa-trash"></i>
                                        Reset & Delete Other Courses
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Registrations -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-clock text-primary"></i> Recent Registrations</h5>
                        </div>
                        <div class="card-body">
                            <div id="recentRegistrations">
                                <!-- Recent registrations will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Courses Section -->
        <div id="coursesSection" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-graduation-cap text-primary"></i> Dance Series</h2>
                        <button class="btn btn-primary" onclick="admin.showCreateCourse()">
                            <i class="fas fa-plus"></i>
                            Create New Dance Series
                        </button>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-12">
                    <select class="form-select" id="courseStatusFilter">
                        <option value="">All Dance Series</option>
                        <option value="active">Active Only</option>
                        <option value="inactive">Inactive Only</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div id="coursesGrid">
                        <!-- Courses grid will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Registrations Section -->
        <div id="registrationsSection" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2><i class="fas fa-users text-primary"></i> Registrations</h2>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary" onclick="admin.openAttendance()">
                                    <i class="fas fa-clipboard-check"></i>
                                    Manage Attendance
                                </button>
                                <button class="btn btn-success" onclick="admin.exportRegistrations()">
                                    <i class="fas fa-download"></i>
                                    Export All
                                </button>
                            </div>
                        </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <select class="form-select" id="regCourseFilter">
                        <option value="">All Dance Series</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <select class="form-select" id="regStatusFilter">
                        <option value="">All Statuses</option>
                        <option value="completed">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div id="registrationsTable">
                                <!-- Registrations table will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reportsSection" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-chart-bar text-primary"></i> Reports</h2>
                        <button class="btn btn-outline-secondary" id="refreshReportsBtn">
                            <i class="fas fa-sync"></i>
                            Refresh
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- By Series -->
                <div class="col-lg-7 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5>Registrations by Series</h5>
                        </div>
                        <div class="card-body" id="reportsBySeries">
                            <div class="text-muted">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- By Status -->
                <div class="col-lg-5 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5>Registrations by Status</h5>
                        </div>
                        <div class="card-body" id="reportsByStatus">
                            <div class="text-muted">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settingsSection" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4"><i class="fas fa-cog text-primary"></i> Settings</h2>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header">
                            <h5>System Configuration</h5>
                        </div>
                        <div class="card-body">
                            <form id="settingsForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="appName" class="form-label">Application Name</label>
                                        <input type="text" class="form-control" id="appName" name="app_name">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="currency" class="form-label">Currency</label>
                                        <select class="form-select" id="currency" name="currency">
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                            <option value="CAD">CAD</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="venmoUsername" class="form-label">Venmo Username</label>
                                        <div class="input-group">
                                            <span class="input-group-text">@</span>
                                            <input type="text" class="form-control" id="venmoUsername" name="venmo_username" placeholder="sangou">
                                        </div>
                                        <div class="form-text">Students will send payments to this Venmo username</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="maxRegistrations" class="form-label">Max Registrations per Student</label>
                                        <input type="number" class="form-control" id="maxRegistrations" name="max_registrations_per_student" min="1" max="10">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="form-check form-switch mt-4">
                                            <input class="form-check-input" type="checkbox" id="allowSameDayDropins" name="allow_same_day_dropins">
                                            <label class="form-check-label" for="allowSameDayDropins">
                                                Allow Same-Day Drop-ins
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="form-check form-switch mt-4">
                                            <input class="form-check-input" type="checkbox" id="emailNotifications" name="email_notifications_enabled">
                                            <label class="form-check-label" for="emailNotifications">
                                                Enable Email Notifications
                                            </label>
                                        </div>
                                    </div>
                                </div>


                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5>Share Registration</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">Generate links and QR codes for sharing with students.</p>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary" onclick="admin.generateShareLink()">
                                    <i class="fas fa-link"></i>
                                    Generate Share Link
                                </button>
                                <button class="btn btn-outline-secondary" onclick="admin.generateQRCode()">
                                    <i class="fas fa-qrcode"></i>
                                    Generate QR Code
                                </button>
                                <button class="btn btn-outline-success" onclick="admin.generateWhatsAppMessage()">
                                    <i class="fab fa-whatsapp"></i>
                                    WhatsApp Message
                                </button>
                            </div>

                            <div id="shareContent" class="mt-3" style="display: none;">
                                <!-- Share content will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <!-- Course Modal -->
    <div class="modal fade" id="courseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="courseModalTitle">Create Dance Series</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="courseForm">
                        <input type="hidden" id="courseId" name="id">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="courseType" class="form-label">Series Type *</label>
                                <select class="form-select" id="courseType" name="course_type" required>
                                    <option value="dance_series">Dance Series</option>
                                    <option value="drop_in">Drop In Class</option>
                                    <option value="crew_practice">Crew Practice</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="courseName" class="form-label">Dance Series Name *</label>
                            <input type="text" class="form-control" id="courseName" name="name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="courseDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="courseDescription" name="description" rows="3"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="courseDuration" class="form-label">Duration (weeks)</label>
                                <input type="number" class="form-control" id="courseDuration" name="duration_weeks" min="1" max="52" value="1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="startDate" class="form-label">Start Date (optional)</label>
                                <input type="date" class="form-control" id="startDate" name="start_date">
                            </div>
                        </div>

                        <!-- Slots Management Section -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Time Slots</h6>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addSlotBtn" onclick="admin.addSlot()">
                                    <i class="fas fa-plus"></i> Add Slot
                                </button>
                            </div>
                            <div class="alert alert-info small" id="slotInfo">
                                <i class="fas fa-info-circle"></i>
                                <span id="slotInfoText">Dance Series and Drop In Classes can have multiple slots. Crew Practice is limited to one slot.</span>
                            </div>
                            <div id="slotsContainer">
                                <!-- Slots will be added here dynamically -->
                            </div>
                        </div>


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="admin.saveCourse()">Save Course</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Modal -->
    <div class="modal fade" id="attendanceModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-clipboard-check text-primary"></i>
                        Manage Attendance
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Course selection/info -->
                        <div class="alert alert-info d-flex align-items-center" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            <div>
                                Select a Dance Series using the Registrations filter, or choose a series directly in this modal to manage attendance.
                            </div>
                        </div>

                    <div class="row">
                        <!-- Sessions column -->
                        <div class="col-lg-5 mb-3">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Class Sessions</h6>
                                    <button class="btn btn-sm btn-outline-primary" id="createSessionBtn">
                                        <i class="fas fa-plus"></i> New Session
                                    </button>
                                </div>
                                <div class="card-body" id="attendanceSessions">
                                    <div class="text-muted">No series selected.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Students/marking column -->
                        <div class="col-lg-7 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Students</h6>
                                </div>
                                <div class="card-body" id="attendanceStudents">
                                    <div class="text-muted">Select a session to mark attendance.</div>
                                </div>
                                <div class="card-footer d-flex justify-content-end">
                                    <button class="btn btn-success" id="saveAttendanceBtn" disabled>
                                        <i class="fas fa-save"></i> Save Attendance
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden create session form -->
                    <div class="card mt-3" id="createSessionForm" style="display: none;">
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label class="form-label">Session Date *</label>
                                    <input type="date" class="form-control" id="att_session_date">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Start Time</label>
                                    <input type="time" class="form-control" id="att_start_time">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">End Time</label>
                                    <input type="time" class="form-control" id="att_end_time">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control" id="att_location" placeholder="Studio A">
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label">Notes</label>
                                    <input type="text" class="form-control" id="att_notes" placeholder="Optional notes">
                                </div>
                            </div>
                            <div class="mt-3 d-flex justify-content-end">
                                <button class="btn btn-secondary me-2" id="cancelCreateSessionBtn">Cancel</button>
                                <button class="btn btn-primary" id="submitCreateSessionBtn">
                                    <i class="fas fa-save"></i> Create Session
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-muted me-auto">Attendance is for records only and does not affect payment.</small>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="errorToast" class="toast" role="alert">
            <div class="toast-header bg-danger text-white">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong class="me-auto">Error</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="errorToastBody"></div>
        </div>

        <div id="successToast" class="toast" role="alert">
            <div class="toast-header bg-success text-white">
                <i class="fas fa-check-circle me-2"></i>
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="successToastBody"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/admin.js?v=18"></script>
</body>
</html>
